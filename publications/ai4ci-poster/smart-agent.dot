digraph G {
    rankdir=TB; // Top to Bottom Layout
    splines=ortho;
    nodesep=0.8;

    node [shape=box, style="rounded", fontname="Arial"];
    edge [ arrowsize="0.75" fontname="Arial" labelfontname="Arial" labelfontsize="12" labeldistance=1.5 ];
    subgraph cluster_behavior {
        label = "Agent Behavior: SmartAgentTesting";
        color = green;
        style = filled;
        fillcolor = "#f0fff0";

        REACTIVE_PCR [
            label = "monitor:\for symptoms\nand risk exposure"
        ];

        TEST_DECISION [
            label = "symptomatic or\nhigh-risk?" shape="diamond"
        ];

        PERFORM_PCR [
            label = "has recent\nPCR test?" shape="diamond"
        ];

        AWAIT_PCR [
            label = "wait for PCR result:\nreduce mobility"
        ];

        TEST_RESULT_DECISION [
            label = "test result?" shape="diamond"
        ];

        SELF_ISOLATE [
            label = "self isolate:\nreduce mobility\ndecrease compliance"
        ];

        ISOLATION_DECISION [
            label = "finish isolation?" shape="diamond"
        ];

        EXIT_TO_DEFAULT [
            label = "Exit to default behavior",
            shape = plaintext
        ];

        // Edges within state machine
        REACTIVE_PCR -> TEST_DECISION;

        TEST_DECISION -> PERFORM_PCR [taillabel="yes"];
        TEST_DECISION -> REACTIVE_PCR [taillabel="no"];

        PERFORM_PCR -> AWAIT_PCR [taillabel="no\nseek test"];
        PERFORM_PCR -> REACTIVE_PCR [taillabel="yes"];

        AWAIT_PCR -> TEST_RESULT_DECISION;

        TEST_RESULT_DECISION -> AWAIT_PCR [taillabel="pending"];
        TEST_RESULT_DECISION -> SELF_ISOLATE [taillabel="positive"];
        TEST_RESULT_DECISION -> REACTIVE_PCR [taillabel="negative"];

        SELF_ISOLATE -> ISOLATION_DECISION;

        ISOLATION_DECISION -> EXIT_TO_DEFAULT [taillabel="yes - non compliant"];
        ISOLATION_DECISION -> REACTIVE_PCR [taillabel="yes - finished"];
        ISOLATION_DECISION -> SELF_ISOLATE [taillabel="no"];
    }
}
