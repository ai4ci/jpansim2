geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1,3,12))+xlim(0,80)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1,0.5,6))+xlim(0,80)
f_gen = function(a,b,c) {
tmp = function(x) (a+cos(2*pi*(x/c)^0.9)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,80)$value
return(function(x) return(tmp(x)/total))
}
f = f_gen(
a=2,
b=1.5,
c=6
)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1,0.5,6))+xlim(0,80)
f_gen = function(a,b,c) {
tmp = function(x) (a+cos(2*pi*(x/c)^0.75)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,80)$value
return(function(x) return(tmp(x)/total))
}
f = f_gen(
a=2,
b=1.5,
c=6
)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1,0.5,6))+xlim(0,80)
f_gen = function(a,b,c) {
tmp = function(x) (a+cos(2*pi*(x/c)^0.85)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,80)$value
return(function(x) return(tmp(x)/total))
}
f = f_gen(
a=2,
b=1.5,
c=6
)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1,0.5,6))+xlim(0,80)
f_gen = function(a,b,c) {
tmp = function(x) (a+cos(2*pi*(x/c)^0.8)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,80)$value
return(function(x) return(tmp(x)/total))
}
f = f_gen(
a=2,
b=1.5,
c=6
)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1,0.5,6))+xlim(0,80)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(2,0.5,6))+xlim(0,80)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.5,6))+xlim(0,80)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.75,6))+xlim(0,80)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.5,6))+xlim(0,80)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6))+xlim(0,80)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6.5))+xlim(0,80)
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6.25))+xlim(0,80)
f_gen = function(a,b,c,d) {
tmp = function(x) (a+cos(2*pi*(x/c)^d)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,80)$value
return(function(x) return(tmp(x)/total))
}
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6.25,0.8))+xlim(0,80)
f_gen = function(a,b,c,d) {
tmp = function(x) (a+cos(2*pi*(x/c)^d)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,Inf)$value
return(function(x) return(tmp(x)/total))
}
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6.25,0.8))+xlim(0,80)
f_gen = function(a,b,c,d) {
tmp = function(x) (a+cos(2*pi*(x/c)^d)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,1000)$value
return(function(x) return(tmp(x)/total))
}
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6.25,0.8))+xlim(0,80)
f_gen = function(a,b,c,d) {
tmp = function(x) (a+cos(2*pi*(x/c)^d)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,1000)$value
print(total)
return(function(x) return(tmp(x)/total))
}
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6.25,0.8))+xlim(0,80)
sapply(0:100, function(x) integrate(f_gen(1.2,0.25,6.25,0.8),0,x))
sapply(0:100, function(x) integrate(f_gen(1.2,0.25,6.25,0.8),0,x)$value)
f_gen = function(a,b,c,d) {
tmp = function(x) (a+cos(2*pi*(x/c)^d)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,100)$value
print(total)
return(function(x) return(tmp(x)/total))
}
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6.25,0.8))+xlim(0,80)
sapply(0:100, function(x) integrate(f_gen(1.2,0.25,6.25,0.8),0,x)$value)
agediff$mid_age_diff
na.omit(agediff$mid_age_diff)
sapply(1:100, function(x) sum(na.omit(agediff$mid_age_diff)<x))
cum = sapply(1:100, function(x) sum(na.omit(agediff$mid_age_diff)<x))
cdf = tibble(
diff=1:100,
cdf = cum/max(cum)
)
ggplot(cdf,aes(x=x,y=cdf))+geom_line()
ggplot(cdf,aes(x=diff,y=cdf))+geom_line()
ggplot(cdf,aes(x=diff,y=cdf))+
geom_line()+
geom_function(fun = g_gen(20,10,13,0.9))+xlim(0,80)
g_gen = function(a,b,c,d) {
return(function(x) 1-exp(-x/a)(1+1/b*sin(2*pi*x^d/c)^2))
}
ggplot(cdf,aes(x=diff,y=cdf))+
geom_line()+
geom_function(fun = g_gen(20,10,13,0.9))+xlim(0,80)
g_gen(20,10,13,0.9)
g = g_gen(20,10,13,0.9)
g(1)
g_gen = function(a,b,c,d) {
return(function(x) 1-exp(-x/a)*(1+1/b*sin(2*pi*x^d/c)^2))
}
g = g_gen(20,10,13,0.9)
g(1)
ggplot(cdf,aes(x=diff,y=cdf))+
geom_line()+
geom_function(fun = g_gen(20,10,13,0.9))+xlim(0,80)
ggplot(cdf,aes(x=diff,y=cdf))+
geom_line()+
geom_function(fun = g_gen(20,10,13,0.9), colour="red")+xlim(0,80)
ggplot(cdf,aes(x=diff,y=cdf))+
geom_line()+
geom_function(fun = g_gen(20,8,13,0.9), colour="red")+xlim(0,80)
ggplot(cdf,aes(x=diff,y=cdf))+
geom_line()+
geom_function(fun = g_gen(20,8,13,0.85), colour="red")+xlim(0,80)
ggplot(cdf,aes(x=diff,y=cdf))+
geom_line()+
geom_function(fun = g_gen(20,8,11,0.85), colour="red")+xlim(0,80)
ggplot(cdf,aes(x=diff,y=cdf))+
geom_line()+
geom_function(fun = g_gen(18,8,11,0.85), colour="red")+xlim(0,80)
ggplot(cdf,aes(x=diff,y=cdf))+
geom_line()+
geom_function(fun = g_gen(19,8,11,0.85), colour="red")+xlim(0,80)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = tan, colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = tan*100, colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = ~ tan(.x)*100, colour="red")+xlim(0,1)
tan(1)
tan(pi)
tan(pi/2)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = ~ tan(.x*pi/2), colour="red")+xlim(0,1)
arctan(100)
invtan(100)
?tan
atan(100)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = ~ tan(.x*atan(100)), colour="red")+xlim(0,1)
cdf_gen = function(a) {
return(function(x) a*tan(x*atan(100/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(3.5)), colour="red")+xlim(0,1)
cdf_gen = function(a) {
return(function(x) a*tan(x*atan(100/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(3.5), colour="red")+xlim(0,1)
cdf_gen = function(a) {
return(function(x) a*tan(x*atan(100/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(5), colour="red")+xlim(0,1)
cdf_gen = function(a) {
return(function(x) a*tan(x*atan(100/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(10), colour="red")+xlim(0,1)
cdf_gen = function(a) {
return(function(x) a*tan(x*atan(100/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(15), colour="red")+xlim(0,1)
cdf_gen = function(a) {
return(function(x) a*tan(x*atan(100/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(20), colour="red")+xlim(0,1)
cdf_gen = function(a) {
return(function(x) a*tan(x*atan(75/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(20), colour="red")+xlim(0,1)
cdf_gen = function(a,b,c,d) {
return(function(x) a*tan((x+c*cos(b*pi/2*x^d))*atan(75/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(20,15,0.02,2.2), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(20,15,0.02,1.8), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(20,15,0.015,2.6), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(20,15,0.01,2.6), colour="red")+xlim(0,1)
cdf_gen = function(a,b,c,d) {
return(function(x) a*tan((x+c*(1-x)*cos(b*pi/2*x^d))*atan(75/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(20,20,0.07,3), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(16,20,0.07,3), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(17,20,0.07,3), colour="red")+xlim(0,1)
cdf_gen = function(a,b,c,d) {
return(function(x) a*tan((x+c*(1-x^2)*cos(b*pi/2*x^d))*atan(75/a)))
}
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(17,20,0.036,3), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(18,20,0.036,3), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(18,25,0.036,3), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(18,25,0.036,4), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(18,23,0.036,3.5), colour="red")+xlim(0,1)
ggplot(cdf,aes(x=cdf,y=diff))+
geom_line()+
geom_function(fun = cdf_gen(18,23,0.03,3.5), colour="red")+xlim(0,1)
f_gen = function(a,b,c,d) {
tmp = function(x) (a+cos(2*pi*(x/c)^d)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,100)$value
print(total)
return(function(x) return(tmp(x)/total))
}
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6.25,0.8))+xlim(0,80)
sapply(0:100, function(x) integrate(f_gen(1.2,0.25,6.25,0.8),0,x)$value)
tibble(
agediff = 1:100,
p = f(1:100)
) %>% mutate(
odds = p/(1-p)
) %>% glimpse()
tibble(
agediff = 1:100,
p = f(1:100)
) %>% mutate(
rr = p/mean(p)
) %>% glimpse()
x = tibble(
agediff = 1:100,
p = f(1:100)
) %>% mutate(
rr = p/mean(p)
)
sum(x$rr)
mean(x$rr)
sum(x$p)
x = tibble(
agediff = 0:100,
p = f(0:100)
) %>% mutate(
rr = p/mean(p)
)
sum(x$p)
x = tibble(
agediff = 0:99,
p = f(0:99)
) %>% mutate(
rr = p/mean(p)
)
sum(x$p)
f_gen = function(a,b,c,d) {
tmp = function(x) (a+cos(2*pi*(x/c)^d)) / ((a+1)*(b*(x/c)^2+1))
total = integrate(tmp,0,100)$value
print(total)
return(function(x) return(tmp(x)/total))
}
ggplot(agediff)+
geom_density(aes(x=abs(mid_age_diff)), colour="red")+
geom_function(fun = f_gen(1.2,0.25,6.25,0.8))+xlim(0,80)
sapply(0:100, function(x) integrate(f_gen(1.2,0.25,6.25,0.8),0,x)$value)
f = f_gen(1.2,0.25,6.25,0.8)
x = tibble(
agediff = 0:99,
p = f(0:99)
) %>% mutate(
rr = p/mean(p)
)
sum(x$p)
x = tibble(
agediff = 0:100,
p = f(0:100)
) %>% mutate(
rr = p/mean(p)
)
sum(x$p)
mean(x$p)
knitr::opts_chunk$set(echo = TRUE)
here::i_am("abm-output.qmd")
library(tidyverse)
# install.packages(
#   c("odin","odin.dust","dust"),
#   repos = c("https://mrc-ide.r-universe.dev", "https://cloud.r-project.org"))
summary = readr::read_csv("~/tmp/summary.csv")
ggplot(summary,aes(x=time,y=incidence, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=cumulativeInfections, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=infectedCount/10000, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()+ylab("actual prevalence")
ggplot(summary,aes(x=time,y=averageMobility, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=averageCompliance, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=presumedTestPositivePrevalence, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=testPositives, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=testNegatives, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=testPositives/(testPositives+testNegatives), colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=rtEffective, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()+coord_cartesian(ylim=c(0,5))
ggplot(summary,aes(x=time,fill=as.factor(policy),colour=as.factor(policy),y=1))+geom_bar(stat="identity")
summary %>% group_by(policy) %>% count()
# ip = ggoutbreak::make_gamma_ip(median_of_mean = 7, median_of_sd = 4)
ip = readr::read_csv("~/tmp/ip.csv")
ip = ip %>% mutate(boot = as.integer(as.factor(experiment))) %>% group_by(boot,tau) %>%
summarise(probability = mean(probability))
summary2 = summary %>% mutate(
time = ggoutbreak::as.time_period(time, unit="1 day"),
count = incidence) %>%
group_by(experimentName,experimentReplica)
estimate = summary2 %>%
ggoutbreak::poisson_locfit_model() %>%
ggoutbreak::rt_from_incidence(ip)
summary2 %>% ggoutbreak::plot_counts(mapping = aes(colour=experimentName, group=interaction(experimentName,experimentReplica)))
estimate %>% ggoutbreak::plot_growth_rate(mapping = aes(colour=experimentName,group=interaction(experimentName,experimentReplica)))
estimate %>% ggoutbreak::plot_rt(mapping = aes(colour=experimentName,group=interaction(experimentName,experimentReplica))) +
geom_point(data = summary,aes(x=as.Date(ggoutbreak::as.time_period(time, unit="1 day")),y=rtEffective, colour=experimentName))
summary = readr::read_csv("~/tmp/summary.csv")
ggplot(summary,aes(x=time,y=incidence, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=cumulativeInfections, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=infectedCount/10000, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()+ylab("actual prevalence")
ggplot(summary,aes(x=time,y=averageMobility, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=averageCompliance, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=presumedTestPositivePrevalence, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=testPositives, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=testNegatives, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=testPositives/(testPositives+testNegatives), colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()
ggplot(summary,aes(x=time,y=rtEffective, colour=experimentName, group=interaction(experimentName,experimentReplica)))+geom_line()+coord_cartesian(ylim=c(0,5))
ggplot(summary,aes(x=time,fill=as.factor(policy),colour=as.factor(policy),y=1))+geom_bar(stat="identity")
summary %>% group_by(policy) %>% count()
knitr::opts_chunk$set(echo = TRUE)
here::i_am("abm-output.qmd")
library(tidyverse)
# install.packages(
#   c("odin","odin.dust","dust"),
#   repos = c("https://mrc-ide.r-universe.dev", "https://cloud.r-project.org"))
demog = readr::read_csv("~/tmp/demog.csv")
ggplot(demog,aes(x=age))+geom_density()
ggplot(demog,aes(x=age,y=mobilityBaseline))+geom_point(alpha=0.01)
contacts = readr::read_csv("~/tmp/contact.csv")
contacts %>% glimpse()
demog = readr::read_csv("~/tmp/demog.csv")
ggplot(demog,aes(x=age))+geom_density()
demog = readr::read_csv("~/tmp/demog.csv")
ggplot(demog,aes(x=age))+geom_density()
ggplot(demog,aes(x=age,y=mobilityBaseline))+geom_point(alpha=0.01)
contacts = readr::read_csv("~/tmp/contact.csv")
contacts %>% glimpse()
contact_matrix = contacts %>%
filter(experimentName == "strategy:ignore") %>%
select(id,contactId) %>%
inner_join(demog %>% select(age,id) %>% filter(experimentName == "strategy:ignore"), by="id") %>%
inner_join(demog %>% select(contactAge = age,contactId=id) %>% filter(experimentName == "strategy:ignore"), by="contactId") %>%
mutate(age = floor(age), contactAge=floor(contactAge)) %>%
group_by(age,contactAge) %>%
count()
contact_matrix = contacts %>%
filter(experimentName == "strategy:ignore") %>%
select(id,contactId) %>%
inner_join(demog %>% filter(experimentName == "strategy:ignore") %>% select(age,id), by="id") %>%
inner_join(demog %>% filter(experimentName == "strategy:ignore") %>% select(contactAge = age,contactId=id), by="contactId") %>%
mutate(age = floor(age), contactAge=floor(contactAge)) %>%
group_by(age,contactAge) %>%
count()
contact_matrix %>% glimpse()
ggplot(contact_matrix, aes(x=age,y=contactAge,fill=n)) %>% geom_rect()
ggplot(contact_matrix, aes(x=age,y=contactAge,fill=n))+geom_rect()
ggplot(contact_matrix, aes(x=age,y=contactAge,fill=n))+geom_tile()
ggplot(demog,aes(x=age))+geom_density()
demog %>% mutate(age = floor(age)) %>% group_by(age) %>%
summarise(
count = n(),
density = n() / sum(count)
) %>% glimpse()
demog %>% mutate(age = floor(age)) %>% group_by(age) %>%
summarise(
count = n()
) %>%
mutate(
density = count/sum(count)
) %>%
glimpse()
expected = demog %>% mutate(age = floor(age)) %>% group_by(age) %>%
summarise(
count = n()
) %>%
mutate(
density = count/sum(count)
)
?toupper
expected %>% cross_join(expected %>% rename_with(.fn = ~ paste0("contact",stringr::str_to_title(.x)))) %>%
glimpse()
expected = expected %>% cross_join(expected %>% rename_with(.fn = ~ paste0("contact",stringr::str_to_title(.x)))) %>%
mutate(expected = density*contactDesity*nrow(contacts))
expected = expected %>% cross_join(expected %>% rename_with(.fn = ~ paste0("contact",stringr::str_to_title(.x)))) %>%
mutate(expected = density*contactDensity*nrow(contacts))
tmp = contact_matrix %>% inner_join(expected %>% select(age,contactAge,expected)) %>%
mutate(contactRR = n/expected)
ggplot(contact_matrix, aes(x=age,y=contactAge,fill=contactRR))+geom_tile()
ggplot(tmp, aes(x=age,y=contactAge,fill=contactRR))+geom_tile()
?scale_fill_continuous
ggplot(tmp, aes(x=age,y=contactAge,fill=contactRR))+geom_tile()+scale_fill_viridis_c(limits=c(0.5, 1.5), oob=scales::squish)
ggplot(tmp, aes(x=age,y=contactAge,fill=contactRR))+geom_tile()+scale_fill_viridis_c(limits=c(0.5, 2.5), oob=scales::squish)
ggplot(tmp, aes(x=age,y=contactAge,fill=contactRR))+geom_tile()+scale_fill_viridis_c(limits=c(0.5, 2), oob=scales::squish)
plot(loess(y~x, data=tibble(x=c(0,10,25,40,60,70), y=c(2,0.5,1.5,0.5,1,0.5))))
loess(y~x, data=tibble(x=c(0,10,25,40,60,70), y=c(2,0.5,1.5,0.5,1,0.5)))
loess.smooth(x=c(0,10,25,40,60,70), y=c(2,0.5,1.5,0.5,1,0.5))
plot(loess.smooth(x=c(0,10,25,40,60,70), y=c(2,0.5,1.5,0.5,1,0.5)))
plot(smooth(x=c(0,10,25,40,60,70), y=c(2,0.5,1.5,0.5,1,0.5)))
plot(smooth.spline(x=c(0,10,25,40,60,70), y=c(2,0.5,1.5,0.5,1,0.5)))
demog = readr::read_csv("~/tmp/demog.csv")
ggplot(demog,aes(x=age))+geom_density()
ggplot(demog,aes(x=age,y=mobilityBaseline))+geom_point(alpha=0.01)
ggplot(demog,aes(x=age))+geom_density()
ggplot(demog,aes(x=age,y=mobilityBaseline))+geom_point(alpha=0.01)
ggplot(demog,aes(x=age,y=mobilityBaseline))+geom_point(alpha=0.1)
contacts = readr::read_csv("~/tmp/contact.csv")
contacts %>% glimpse()
expected = demog %>% mutate(age = floor(age)) %>% group_by(age) %>%
summarise(
count = n()
) %>%
mutate(
density = count/sum(count)
)
expected = expected %>% cross_join(expected %>% rename_with(.fn = ~ paste0("contact",stringr::str_to_title(.x)))) %>%
mutate(expected = density*contactDensity*nrow(contacts))
contact_matrix = contacts %>%
filter(experimentName == "strategy:ignore") %>%
select(id,contactId) %>%
inner_join(demog %>% filter(experimentName == "strategy:ignore") %>% select(age,id), by="id") %>%
inner_join(demog %>% filter(experimentName == "strategy:ignore") %>% select(contactAge = age,contactId=id), by="contactId") %>%
mutate(age = floor(age), contactAge=floor(contactAge)) %>%
group_by(age,contactAge) %>%
count()
tmp = contact_matrix %>% inner_join(expected %>% select(age,contactAge,expected), by = join_by(age, contactAge)) %>%
mutate(contactRR = n/expected)
ggplot(tmp, aes(x=age,y=contactAge,fill=contactRR))+geom_tile()+scale_fill_viridis_c(limits=c(0.5, 2), oob=scales::squish)
ggplot(demog,aes(x=age))+geom_density()
